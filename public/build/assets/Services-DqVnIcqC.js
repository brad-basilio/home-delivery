var q=Object.defineProperty;var J=(a,t,m)=>t in a?q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[t]=m;var N=(a,t,m)=>(J(a,typeof t!="symbol"?t+"":t,m),m);import{j as i}from"./FileViewer-DkaHswXt.js";import{r as n}from"./TrackingPixels-B80Lgev0.js";import{B as P}from"./Base-ChcpYhcb.js";import{c as U}from"./ReactAppend-CY8yKZvG.js";import{r as V}from"./DxBox-C52wWe69.js";import{S as z}from"./sweetalert2.all-C96erxsa.js";import{B as W}from"./Results-D258VEiO.js";import{M as H}from"./Modal-CJBbhQ-7.js";import{T as K}from"./Table-ux6p-2ih.js";import{I as S}from"./ImageFormGroup-yZTAH_8o.js";import{I as Q}from"./InputFormGroup-DDhzlCe_.js";import{D as E}from"./DxButton-CsjWvhyj.js";import{C as X}from"./CreateReactScript-BEktg6JA.js";import{R as I}from"./ReactAppend-Yu2UtNlL.js";import{S as Y}from"./SwitchFormGroup-COj39dTx.js";import{L as Z}from"./Filter-BZ5YA63n.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";/* empty css               */class ee extends W{constructor(){super(...arguments);N(this,"path","admin/services");N(this,"hasFiles",!0)}}const v=new ee,re=a=>{const[t,m]=n.useState([]),g=n.useRef(),d=n.useRef(),l=n.useRef(),F=n.useRef(),p=n.useRef(),b=n.useRef(),j=n.useRef(),y=n.useRef(),f=n.useRef(),[R,x]=n.useState([]),[u,h]=n.useState([{value:""}]),[w,G]=n.useState(!1),T=e=>{const s=Array.from(e.target.files).map(c=>({file:c,url:URL.createObjectURL(c),isNew:!0}));x(c=>[...c,...s])},B=e=>{x(r=>r.filter((s,c)=>c!==e))},D=()=>{h([...u,{value:""}])},k=(e,r)=>{const s=[...u];s[e].value=r,h(s)},_=e=>{if(u.length<=1)return;const r=u.filter((s,c)=>c!==e);h(r)},C=e=>{m(e||null),G(!!(e!=null&&e.id)),b.current.value=(e==null?void 0:e.id)||"",j.current.value=(e==null?void 0:e.title)||"",y.current.value=(e==null?void 0:e.description)||"",f.current.value=null;const r=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(m({...e,transparent_color:!r,color:r?e==null?void 0:e.color:"transparent"}),e!=null&&e.image)try{l&&l.image&&(l.image.src=`/api/service/media/${e.image}`)}catch{}else l&&l.current&&(l.current.value=null);try{p&&p.current&&(p.current.value=(e==null?void 0:e.lang_id)??1)}catch{}if(e!=null&&e.icon&&(f.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const s=e.gallery.map(c=>({url:`/api/service/media/${c}`,isNew:!1}));x(s)}else x([]);e!=null&&e.characteristics&&e.characteristics.length>0?h(e.characteristics.map(s=>({value:s}))):h([{value:""}]),$(d.current).modal("show")},A=async e=>{e.preventDefault();const r=new FormData;r.append("title",j.current.value),r.append("description",y.current.value),w&&r.append("id",b.current.value),l&&l.current&&l.current.files&&l.current.files[0]&&r.append("image",l.current.files[0]),r.append("lang_id",p&&p.current&&p.current.value?p.current.value:1),f.current.files[0]&&r.append("icon",f.current.files[0]),R.filter(o=>o.isNew).forEach((o,M)=>{r.append(`gallery[${M}]`,o.file)});const s=R.filter(o=>!o.isNew).map(o=>o.url.split("/").pop());r.append("existing_gallery",JSON.stringify(s));const c=u.map(o=>o.value.trim()).filter(o=>o.length>0);r.append("characteristics",JSON.stringify(c)),await v.save(r)&&($(g.current).dxDataGrid("instance").refresh(),$(d.current).modal("hide"),x([]),h([{value:""}]),f.current.value=null)},O=async e=>{const{isConfirmed:r}=await z.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await v.delete(e)||$(g.current).dxDataGrid("instance").refresh()},L=async({id:e,value:r})=>{await v.boolean({id:e,field:"visible",value:r})&&$(g.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(K,{gridRef:g,title:"Servicios",rest:v,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(g.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>C()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(V(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:r})=>{r.icon?I(e,i.jsx("img",{src:`/api/service/media/${r.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:r})=>{$(e).empty(),I(e,i.jsx(Y,{checked:r.visible==1,onChange:()=>L({id:r.id,value:!r.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(E({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>C(r)})),e.append(E({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>O(r.id)}))}}]}),i.jsxs(H,{modalRef:d,title:w?"Editar Servicio":"Nuevo Servicio",onSubmit:A,size:"lg",children:[i.jsx("input",{ref:b,type:"hidden"}),i.jsx("input",{ref:p,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-8",children:[i.jsx(Q,{eRef:j,label:"Título del servicio",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:y,className:"form-control",rows:4,required:!0})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),u.map((e,r)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Entrega en 24h",value:e.value,onChange:s=>k(r,s.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>_(r),disabled:u.length<=1,children:i.jsx("i",{className:"fas fa-times"})})]},r)),i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:D,children:[i.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),i.jsxs("div",{className:"col-md-4",children:[i.jsx(S,{eRef:l,label:"Imagen principal",aspect:16/9,overlayColor:t!=null&&t.transparent_color?null:t==null?void 0:t.color,showColorOverlay:!0}),i.jsx(S,{eRef:f,label:"Icono del servicio",aspect:1/1}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Galería de imágenes"}),i.jsx("input",{type:"file",ref:F,multiple:!0,accept:"image/*",onChange:T,className:"form-control"}),i.jsx("div",{className:"d-flex flex-wrap gap-2 mt-2",children:R.map((e,r)=>i.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[i.jsx("img",{src:e.url,alt:"Preview",className:"img-thumbnail h-100 w-100 object-fit-cover"}),i.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0",onClick:()=>B(r),children:"×"})]},r))})]})]})]})]})]})};X((a,t)=>{U(a).render(i.jsx(Z,{children:i.jsx(P,{...t,title:"Servicios",children:i.jsx(re,{...t})})}))});
