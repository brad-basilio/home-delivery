var J=Object.defineProperty;var U=(a,t,m)=>t in a?J(a,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[t]=m;var R=(a,t,m)=>(U(a,typeof t!="symbol"?t+"":t,m),m);import{j as i}from"./FileViewer-DkaHswXt.js";import{r as l}from"./TrackingPixels-B80Lgev0.js";import{B as V}from"./Base-ClvkqiQu.js";import{c as H}from"./ReactAppend-CY8yKZvG.js";import{r as P}from"./DxBox-C52wWe69.js";import{S as W}from"./sweetalert2.all-C96erxsa.js";import{B as K}from"./Results-D258VEiO.js";import{M as Q}from"./Modal-CJBbhQ-7.js";import{T as X}from"./Table-ux6p-2ih.js";import{I as F}from"./ImageFormGroup-BNrhaHkj.js";import{I as Y}from"./InputFormGroup-DDhzlCe_.js";import{D as E}from"./DxButton-CsjWvhyj.js";import{C as Z}from"./CreateReactScript-BEktg6JA.js";import{R as b}from"./ReactAppend-Yu2UtNlL.js";import{S as I}from"./SwitchFormGroup-COj39dTx.js";import{L as ee}from"./Filter-BZ5YA63n.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";/* empty css               */class re extends K{constructor(){super(...arguments);R(this,"path","admin/services");R(this,"hasFiles",!0)}}const v=new re,ie=a=>{const[t,m]=l.useState([]),f=l.useRef(),j=l.useRef(),n=l.useRef(),T=l.useRef(),p=l.useRef(),y=l.useRef(),w=l.useRef(),N=l.useRef(),d=l.useRef(),[h,x]=l.useState([]),[u,g]=l.useState([{value:""}]),[C,G]=l.useState(!1),D=e=>{const s=Array.from(e.target.files).map(c=>({file:c,url:URL.createObjectURL(c),isNew:!0}));x(c=>[...c,...s])},k=e=>{x(r=>r.filter((s,c)=>c!==e))},B=()=>{g([...u,{value:""}])},_=(e,r)=>{const s=[...u];s[e].value=r,g(s)},A=e=>{if(u.length<=1)return;const r=u.filter((s,c)=>c!==e);g(r)},S=e=>{m(e||null),G(!!(e!=null&&e.id)),y.current.value=(e==null?void 0:e.id)||"",w.current.value=(e==null?void 0:e.title)||"",N.current.value=(e==null?void 0:e.description)||"",d.current.value=null;const r=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(m({...e,transparent_color:!r,color:r?e==null?void 0:e.color:"transparent"}),e!=null&&e.image)try{n&&n.image&&(n.image.src=`/api/service/media/${e.image}`)}catch{}else n&&n.current&&(n.current.value=null);try{p&&p.current&&(p.current.value=(e==null?void 0:e.lang_id)??1)}catch{}if(e!=null&&e.icon&&(d.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const s=e.gallery.map(c=>({url:`/api/service/media/${c}`,isNew:!1}));x(s)}else x([]);e!=null&&e.characteristics&&e.characteristics.length>0?g(e.characteristics.map(s=>({value:s}))):g([{value:""}]),$(j.current).modal("show")},O=async e=>{e.preventDefault();const r=new FormData;r.append("title",w.current.value),r.append("description",N.current.value),C&&r.append("id",y.current.value),n&&n.current&&n.current.files&&n.current.files[0]&&r.append("image",n.current.files[0]),r.append("lang_id",p&&p.current&&p.current.value?p.current.value:1),d.current.files[0]&&r.append("icon",d.current.files[0]),h.filter(o=>o.isNew).forEach((o,z)=>{r.append(`gallery[${z}]`,o.file)});const s=h.filter(o=>!o.isNew).map(o=>o.url.split("/").pop());r.append("existing_gallery",JSON.stringify(s));const c=u.map(o=>o.value.trim()).filter(o=>o.length>0);r.append("characteristics",JSON.stringify(c)),await v.save(r)&&($(f.current).dxDataGrid("instance").refresh(),$(j.current).modal("hide"),x([]),g([{value:""}]),d.current.value=null)},L=async e=>{const{isConfirmed:r}=await W.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await v.delete(e)||$(f.current).dxDataGrid("instance").refresh()},M=async({id:e,value:r})=>{await v.boolean({id:e,field:"visible",value:r})&&$(f.current).dxDataGrid("instance").refresh()},q=async({id:e,value:r})=>{await v.boolean({id:e,field:"featured",value:r})&&$(f.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(X,{gridRef:f,title:"Servicios",rest:v,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(f.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(P(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:r})=>{r.image?b(e,i.jsx("img",{src:`/api/service/media/${r.image}`,style:{width:"60px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-image.png"})):e.html('<span class="text-muted">Sin imagen</span>')}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:r})=>{r.icon?b(e,i.jsx("img",{src:`/api/service/media/${r.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"100px",cellTemplate:(e,{data:r})=>{$(e).empty(),b(e,i.jsx(I,{checked:r.featured==1,onChange:()=>q({id:r.id,value:!r.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"100px",cellTemplate:(e,{data:r})=>{$(e).empty(),b(e,i.jsx(I,{checked:r.visible==1,onChange:()=>M({id:r.id,value:!r.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(E({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>S(r)})),e.append(E({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>L(r.id)}))}}]}),i.jsxs(Q,{modalRef:j,title:C?"Editar Servicio":"Nuevo Servicio",onSubmit:O,size:"lg",children:[i.jsx("input",{ref:y,type:"hidden"}),i.jsx("input",{ref:p,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-8",children:[i.jsx(Y,{eRef:w,label:"Título del servicio",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:N,className:"form-control",rows:4,required:!0})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),u.map((e,r)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Entrega en 24h",value:e.value,onChange:s=>_(r,s.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>A(r),disabled:u.length<=1,children:i.jsx("i",{className:"fas fa-times"})})]},r)),i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:B,children:[i.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),i.jsx("div",{className:"col-md-4",children:i.jsx(F,{eRef:n,label:"Imagen principal",aspect:9/16,overlayColor:t!=null&&t.transparent_color?null:t==null?void 0:t.color,showColorOverlay:!0})}),i.jsx("div",{className:"col-md-4",children:i.jsx(F,{eRef:d,label:"Icono del servicio",aspect:1/1,className:"p-2"})}),i.jsx("div",{className:"col-md-8",children:i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Galería de imágenes"}),i.jsx("input",{type:"file",ref:T,multiple:!0,accept:"image/*",onChange:D,className:"form-control mb-2"}),i.jsx("div",{className:"d-flex flex-wrap gap-2",children:h.map((e,r)=>i.jsxs("div",{className:"position-relative",style:{width:"80px",height:"80px"},children:[i.jsx("img",{src:e.url,alt:`Galería ${r+1}`,className:"img-thumbnail h-100 w-100 object-fit-cover rounded",style:{aspectRatio:"1 / 1",objectFit:"cover"}}),i.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0 m-1",style:{width:"20px",height:"20px",padding:"0",lineHeight:"18px",fontSize:"14px"},onClick:()=>k(r),title:"Eliminar imagen",children:"×"})]},r))}),h.length>0&&i.jsxs("small",{className:"text-muted d-block mt-2",children:[h.length," imagen",h.length!==1?"es":""," en galería"]})]})})]})]})]})};Z((a,t)=>{H(a).render(i.jsx(ee,{children:i.jsx(V,{...t,title:"Servicios",children:i.jsx(ie,{...t})})}))});
