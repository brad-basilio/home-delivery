var P=Object.defineProperty;var U=(a,t,m)=>t in a?P(a,t,{enumerable:!0,configurable:!0,writable:!0,value:m}):a[t]=m;var N=(a,t,m)=>(U(a,typeof t!="symbol"?t+"":t,m),m);import{j as i}from"./FileViewer-DkaHswXt.js";import{r as n}from"./TrackingPixels-B80Lgev0.js";import{B as V}from"./Base-qkus41MS.js";import{c as z}from"./ReactAppend-CY8yKZvG.js";import{r as W}from"./DxBox-C52wWe69.js";import{S as H}from"./sweetalert2.all-C96erxsa.js";import{B as K}from"./Results-D258VEiO.js";import{M as Q}from"./Modal-CJBbhQ-7.js";import{T as X}from"./Table-ux6p-2ih.js";import{I as F}from"./ImageFormGroup-yZTAH_8o.js";import{I as Y}from"./InputFormGroup-DDhzlCe_.js";import{D as E}from"./DxButton-CsjWvhyj.js";import{C as Z}from"./CreateReactScript-BEktg6JA.js";import{R as v}from"./ReactAppend-Yu2UtNlL.js";import{S as I}from"./SwitchFormGroup-COj39dTx.js";import{L as ee}from"./Filter-BZ5YA63n.js";import"./tippy-react.esm-CIcmk6y-.js";import"./index-CbrplguO.js";/* empty css              */import"./Logout-CHcSRTk-.js";import"./main-D1ujSG59.js";import"./___vite-browser-external_commonjs-proxy-DjIx6Adb.js";import"./index.esm-Duzu12F9.js";import"./axios-B4uVmeYG.js";import"./useTranslation-BOupZ7-X.js";/* empty css               */class re extends K{constructor(){super(...arguments);N(this,"path","admin/services");N(this,"hasFiles",!0)}}const x=new re,ie=a=>{const[t,m]=n.useState([]),f=n.useRef(),b=n.useRef(),l=n.useRef(),T=n.useRef(),p=n.useRef(),j=n.useRef(),y=n.useRef(),w=n.useRef(),h=n.useRef(),[R,g]=n.useState([]),[u,d]=n.useState([{value:""}]),[C,D]=n.useState(!1),G=e=>{const s=Array.from(e.target.files).map(c=>({file:c,url:URL.createObjectURL(c),isNew:!0}));g(c=>[...c,...s])},B=e=>{g(r=>r.filter((s,c)=>c!==e))},k=()=>{d([...u,{value:""}])},_=(e,r)=>{const s=[...u];s[e].value=r,d(s)},A=e=>{if(u.length<=1)return;const r=u.filter((s,c)=>c!==e);d(r)},S=e=>{m(e||null),D(!!(e!=null&&e.id)),j.current.value=(e==null?void 0:e.id)||"",y.current.value=(e==null?void 0:e.title)||"",w.current.value=(e==null?void 0:e.description)||"",h.current.value=null;const r=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(m({...e,transparent_color:!r,color:r?e==null?void 0:e.color:"transparent"}),e!=null&&e.image)try{l&&l.image&&(l.image.src=`/api/service/media/${e.image}`)}catch{}else l&&l.current&&(l.current.value=null);try{p&&p.current&&(p.current.value=(e==null?void 0:e.lang_id)??1)}catch{}if(e!=null&&e.icon&&(h.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const s=e.gallery.map(c=>({url:`/api/service/media/${c}`,isNew:!1}));g(s)}else g([]);e!=null&&e.characteristics&&e.characteristics.length>0?d(e.characteristics.map(s=>({value:s}))):d([{value:""}]),$(b.current).modal("show")},O=async e=>{e.preventDefault();const r=new FormData;r.append("title",y.current.value),r.append("description",w.current.value),C&&r.append("id",j.current.value),l&&l.current&&l.current.files&&l.current.files[0]&&r.append("image",l.current.files[0]),r.append("lang_id",p&&p.current&&p.current.value?p.current.value:1),h.current.files[0]&&r.append("icon",h.current.files[0]),R.filter(o=>o.isNew).forEach((o,J)=>{r.append(`gallery[${J}]`,o.file)});const s=R.filter(o=>!o.isNew).map(o=>o.url.split("/").pop());r.append("existing_gallery",JSON.stringify(s));const c=u.map(o=>o.value.trim()).filter(o=>o.length>0);r.append("characteristics",JSON.stringify(c)),await x.save(r)&&($(f.current).dxDataGrid("instance").refresh(),$(b.current).modal("hide"),g([]),d([{value:""}]),h.current.value=null)},L=async e=>{const{isConfirmed:r}=await H.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!r||!await x.delete(e)||$(f.current).dxDataGrid("instance").refresh()},M=async({id:e,value:r})=>{await x.boolean({id:e,field:"visible",value:r})&&$(f.current).dxDataGrid("instance").refresh()},q=async({id:e,value:r})=>{await x.boolean({id:e,field:"featured",value:r})&&$(f.current).dxDataGrid("instance").refresh()};return i.jsxs(i.Fragment,{children:[i.jsx(X,{gridRef:f,title:"Servicios",rest:x,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(f.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>S()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:r})=>{e.html(W(i.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:r.description})))}},{dataField:"image",caption:"Imagen",width:"100px",cellTemplate:(e,{data:r})=>{r.image?v(e,i.jsx("img",{src:`/api/service/media/${r.image}`,style:{width:"60px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-image.png"})):e.html('<span class="text-muted">Sin imagen</span>')}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:r})=>{r.icon?v(e,i.jsx("img",{src:`/api/service/media/${r.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:s=>s.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"featured",caption:"Destacado",dataType:"boolean",width:"100px",cellTemplate:(e,{data:r})=>{$(e).empty(),v(e,i.jsx(I,{checked:r.featured==1,onChange:()=>q({id:r.id,value:!r.featured})}))}},{dataField:"visible",caption:"Visible",dataType:"boolean",width:"100px",cellTemplate:(e,{data:r})=>{$(e).empty(),v(e,i.jsx(I,{checked:r.visible==1,onChange:()=>M({id:r.id,value:!r.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:r})=>{e.append(E({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>S(r)})),e.append(E({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>L(r.id)}))}}]}),i.jsxs(Q,{modalRef:b,title:C?"Editar Servicio":"Nuevo Servicio",onSubmit:O,size:"lg",children:[i.jsx("input",{ref:j,type:"hidden"}),i.jsx("input",{ref:p,type:"hidden"}),i.jsxs("div",{className:"row",children:[i.jsxs("div",{className:"col-md-8",children:[i.jsx(Y,{eRef:y,label:"Título del servicio",required:!0}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Descripción"}),i.jsx("textarea",{ref:w,className:"form-control",rows:4,required:!0})]}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Características"}),u.map((e,r)=>i.jsxs("div",{className:"input-group mb-2",children:[i.jsx("input",{type:"text",className:"form-control",placeholder:"Ej: Entrega en 24h",value:e.value,onChange:s=>_(r,s.target.value)}),i.jsx("button",{type:"button",className:"btn btn-outline-danger",onClick:()=>A(r),disabled:u.length<=1,children:i.jsx("i",{className:"fas fa-times"})})]},r)),i.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-primary",onClick:k,children:[i.jsx("i",{className:"fas fa-plus me-1"})," Agregar característica"]})]})]}),i.jsxs("div",{className:"col-md-4",children:[i.jsx(F,{eRef:l,label:"Imagen principal",aspect:16/9,overlayColor:t!=null&&t.transparent_color?null:t==null?void 0:t.color,showColorOverlay:!0}),i.jsx(F,{eRef:h,label:"Icono del servicio",aspect:1/1}),i.jsxs("div",{className:"mb-3",children:[i.jsx("label",{className:"form-label",children:"Galería de imágenes"}),i.jsx("input",{type:"file",ref:T,multiple:!0,accept:"image/*",onChange:G,className:"form-control"}),i.jsx("div",{className:"d-flex flex-wrap gap-2 mt-2",children:R.map((e,r)=>i.jsxs("div",{className:"position-relative",style:{width:"100px",height:"100px"},children:[i.jsx("img",{src:e.url,alt:"Preview",className:"img-thumbnail h-100 w-100 object-fit-cover"}),i.jsx("button",{type:"button",className:"btn btn-danger btn-xs position-absolute top-0 end-0",onClick:()=>B(r),children:"×"})]},r))})]})]})]})]})]})};Z((a,t)=>{z(a).render(i.jsx(ee,{children:i.jsx(V,{...t,title:"Servicios",children:i.jsx(ie,{...t})})}))});
