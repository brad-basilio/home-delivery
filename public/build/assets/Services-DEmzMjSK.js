var B=Object.defineProperty;var I=(n,s,l)=>s in n?B(n,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[s]=l;var b=(n,s,l)=>(I(n,typeof s!="symbol"?s+"":s,l),l);import{j as r}from"./FileViewer-CpM0iYLI.js";import{r as o}from"./index-B80Lgev0.js";import{B as G}from"./Base-C_PKP9rm.js";import{c as k}from"./ReactAppend-CBRQCQGz.js";import{r as A}from"./DxBox-CdMuSyGE.js";import{S as M}from"./sweetalert2.all-Dh0rZL5X.js";import{B as O}from"./Results-B9dLaNz0.js";import{M as q}from"./Modal-CbHkO7Dn.js";import{T as J}from"./Table-CEq6jy84.js";import{I as L}from"./ImageFormGroup-D0l3yP43.js";import{I as V}from"./InputFormGroup-DZ3W53Mr.js";import{D as j}from"./DxButton-CsjWvhyj.js";import{C as _}from"./CreateReactScript-Bj11ghWz.js";import{R as y}from"./ReactAppend-C-tNgxIf.js";import{S as z}from"./SwitchFormGroup-ChGOZLEW.js";import{L as P}from"./Filter-CcOrv0Sz.js";import"./tippy-react.esm-CHhA99mn.js";import"./index-DO3Aws4m.js";/* empty css              */import"./Logout-Cj6nvmS-.js";import"./main-Br9xqDfn.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";import"./index.esm-CTa_PdWD.js";import"./axios-B4uVmeYG.js";import"./useTranslation-AtUXdXvN.js";/* empty css               */class W extends O{constructor(){super(...arguments);b(this,"path","admin/services");b(this,"hasFiles",!0)}}const m=new W,H=({brands:n})=>{const[s,l]=o.useState([]),p=o.useRef(),u=o.useRef(),f=o.useRef(),h=o.useRef(),x=o.useRef(),a=o.useRef(),[R,d]=o.useState([]),[N,v]=o.useState([{value:""}]),[S,C]=o.useState(!1),w=e=>{l(e||null),C(!!(e!=null&&e.id)),f.current.value=(e==null?void 0:e.id)||"",h.current.value=(e==null?void 0:e.title)||"",x.current.value=(e==null?void 0:e.description)||"",a.current.value=null;const i=(e==null?void 0:e.color)&&e.color!=="transparent"&&e.color!=="";if(l({...e,transparent_color:!i,color:i?e==null?void 0:e.color:"transparent"}),e!=null&&e.icon&&(a.image.src=`/api/service/media/${e.icon}`),e!=null&&e.gallery){console.log(e==null?void 0:e.gallery);const c=e.gallery.map(g=>({url:`/api/service/media/${g}`,isNew:!1}));d(c)}else d([]);e!=null&&e.characteristics&&e.characteristics.length>0?v(e.characteristics.map(c=>({value:c}))):v([{value:""}]),$(u.current).modal("show")},D=async e=>{e.preventDefault();const i=new FormData;i.append("title",h.current.value),i.append("description",x.current.value),S&&i.append("id",f.current.value),a.current.files[0]&&i.append("icon",a.current.files[0]),R.filter(t=>t.isNew).forEach((t,T)=>{i.append(`gallery[${T}]`,t.file)});const c=R.filter(t=>!t.isNew).map(t=>t.url.split("/").pop());i.append("existing_gallery",JSON.stringify(c));const g=N.map(t=>t.value.trim()).filter(t=>t.length>0);i.append("characteristics",JSON.stringify(g)),await m.save(i)&&($(p.current).dxDataGrid("instance").refresh(),$(u.current).modal("hide"),d([]),v([{value:""}]),a.current.value=null)},E=async e=>{const{isConfirmed:i}=await M.fire({title:"Eliminar Servicio",text:"¿Estás seguro de eliminar este servicio?",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"});!i||!await m.delete(e)||$(p.current).dxDataGrid("instance").refresh()},F=async({id:e,value:i})=>{await m.boolean({id:e,field:"visible",value:i})&&$(p.current).dxDataGrid("instance").refresh()};return r.jsxs(r.Fragment,{children:[r.jsx(J,{gridRef:p,title:"Servicios",rest:m,toolBar:e=>{e.unshift({widget:"dxButton",location:"after",options:{icon:"refresh",hint:"Refrescar tabla",onClick:()=>$(p.current).dxDataGrid("instance").refresh()}}),e.unshift({widget:"dxButton",location:"after",options:{icon:"plus",text:"Agregar",hint:"Agregar nuevo servicio",onClick:()=>w()}})},columns:[{dataField:"id",caption:"ID",visible:!1},{dataField:"title",caption:"Título",width:"200px"},{dataField:"description",caption:"Descripción",cellTemplate:(e,{data:i})=>{e.html(A(r.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},children:i.description})))}},{dataField:"icon",caption:"Icono",width:"80px",cellTemplate:(e,{data:i})=>{i.icon?y(e,r.jsx("img",{src:`/api/service/media/${i.icon}`,style:{width:"40px",height:"40px",objectFit:"cover",borderRadius:"4px"},onError:c=>c.target.src="/images/default-icon.png",className:"bg-secondary p-1"})):e.html('<span class="text-muted">Sin icono</span>')}},{dataField:"visible",caption:"Visible",dataType:"boolean",cellTemplate:(e,{data:i})=>{$(e).empty(),y(e,r.jsx(z,{checked:i.visible==1,onChange:()=>F({id:i.id,value:!i.visible})}))}},{caption:"Acciones",width:"100px",cellTemplate:(e,{data:i})=>{e.append(j({className:"btn btn-xs btn-soft-primary me-1",title:"Editar",icon:"fa fa-pen",onClick:()=>w(i)})),e.append(j({className:"btn btn-xs btn-soft-danger",title:"Eliminar",icon:"fa fa-trash",onClick:()=>E(i.id)}))}}]}),r.jsxs(q,{modalRef:u,title:S?"Editar Servicio":"Nuevo Servicio",onSubmit:D,size:"lg",children:[r.jsx("input",{ref:f,type:"hidden"}),r.jsxs("div",{className:"row",children:[r.jsxs("div",{className:"col-md-8",children:[r.jsx(V,{eRef:h,label:"Título del servicio",required:!0}),r.jsxs("div",{className:"mb-3",children:[r.jsx("label",{className:"form-label",children:"Descripción"}),r.jsx("textarea",{ref:x,className:"form-control",rows:4,required:!0})]})]}),r.jsx("div",{className:"col-md-4",children:r.jsx(L,{eRef:a,label:"Icono del servicio",aspect:1/1})})]})]})]})};_((n,s)=>{k(n).render(r.jsx(P,{children:r.jsx(G,{...s,title:"Servicios",children:r.jsx(H,{...s})})}))});
