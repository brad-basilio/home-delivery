var E=Object.defineProperty;var I=(f,s,i)=>s in f?E(f,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[s]=i;var h=(f,s,i)=>(I(f,typeof s!="symbol"?s+"":s,i),i);import{j as v}from"./FileViewer-CpM0iYLI.js";import{r as q}from"./index-B80Lgev0.js";import{m as x}from"./main-Br9xqDfn.js";import{B as V}from"./Results-B9dLaNz0.js";import"./___vite-browser-external_commonjs-proxy-C9-083JZ.js";class k extends V{constructor(){super(...arguments);h(this,"path","items");h(this,"verifyStock",async i=>{try{const{status:u,result:y}=await x.Fetch(`/api/${this.path}/verify-stock`,{method:"POST",body:JSON.stringify(i)});if(!u)throw new Error((y==null?void 0:y.message)??"Ocurrió un error al consultar el stock de los productos");return y.data??[]}catch{return[]}});h(this,"getDestacados",async()=>{try{const{status:i,result:u}=await x.Fetch(`/api/${this.path}/get-destacados`,{method:"GET"});if(!i)throw new Error((u==null?void 0:u.message)??"Ocurrió un error al consultar el stock de los productos");return u.data??[]}catch{return[]}})}}const O=q.createContext(),P=new k,N=({children:f})=>{const[s,i]=q.useState(()=>{try{const r=localStorage.getItem("carrito");return r?r.startsWith("U2FsdGVkX1")?(localStorage.removeItem("carrito"),[]):JSON.parse(r):[]}catch(r){return console.warn("Error parsing carrito data, clearing localStorage:",r),localStorage.removeItem("carrito"),[]}}),u=async()=>{try{if(s.length===0)return;P.verifyStock(s.map(r=>r.id)).then(r=>{const a=s.map(c=>{const t=r.find(n=>n.id===c.id);return t?{...c,price:t.price,final_price:t.final_price,discount:t.discount,name:t.name}:c});i(a)})}catch(r){console.error("Error al actualizar precios:",r)}};q.useEffect(()=>{u()},[]),q.useEffect(()=>{localStorage.setItem("carrito",JSON.stringify(s))},[s]);const y=r=>{i(a=>{var e;if(!(r.sizes&&r.sizes.length>0||r.colors&&r.colors.length>0))return a.find(o=>o.id===r.id)?a.map(o=>o.id===r.id?{...o,quantity:o.quantity+r.quantity}:o):[...a,{...r,variations:[],quantity:r.quantity}];const t={color:r.selectedColor||null,size:r.selectedSize||null,quantity:r.quantity},n=a.findIndex(l=>l.id===r.id);if(n>=0){const l=[...a],o=l[n],g=((e=o.variations)==null?void 0:e.findIndex(d=>d.color===t.color&&d.size===t.size))??-1;return g>=0?l[n]={...o,variations:o.variations.map((d,p)=>p===g?{...d,quantity:d.quantity+t.quantity}:d)}:l[n]={...o,variations:[...o.variations,t]},l}else return[...a,{...r,variations:[t],quantity:r.quantity}]})},m=r=>{i(a=>a.filter(c=>c.id!==r))},w=()=>{i([])},z=(r,a=null)=>{i(c=>c.map(t=>t.id===r&&(!t.variations||t.variations.length===0)?{...t,quantity:t.quantity+1}:t.id===r&&t.variations&&t.variations.length>0?a?{...t,variations:t.variations.map(n=>n.color===a.color&&n.size===a.size?{...n,quantity:n.quantity+1}:n)}:{...t,variations:t.variations.map((n,e)=>e===0?{...n,quantity:n.quantity+1}:n)}:t))},C=(r,a=null)=>{i(c=>c.map(t=>{if(t.id===r&&(!t.variations||t.variations.length===0))return{...t,quantity:Math.max(1,t.quantity-1)};if(t.id===r&&t.variations&&t.variations.length>0){if(!a){const e=t.variations.map((l,o)=>o===0?{...l,quantity:Math.max(1,l.quantity-1)}:l);return{...t,variations:e}}const n=t.variations.map(e=>e.color===a.color&&e.size===a.size?{...e,quantity:Math.max(1,e.quantity-1)}:e);return{...t,variations:n}}return t}))},S=(r,a=null)=>{i(c=>a?c.map(t=>{if(t.id===r&&t.variations){const n=t.variations.filter(e=>!(e.color===a.color&&e.size===a.size&&e.quantity===0));return n.length===0?null:{...t,variations:n}}return t}).filter(Boolean):c.filter(t=>!(t.id===r&&t.quantity===0)))};return v.jsx(O.Provider,{value:{carrito:s,agregarAlCarrito:y,eliminarProducto:m,vaciarCarrito:w,actualizarPrecios:u,decrementarCantidad:C,incrementarCantidad:z,eliminarSiCero:S},children:f})};export{N as C,O as a};
